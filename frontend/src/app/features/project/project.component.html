<!-- Scharf Design System - Project View -->
<div class="min-h-screen flex">
  <!-- Left Navigation Rail -->
  <nav class="nav-rail flex flex-col items-center py-6 fixed h-full">
    <div class="mb-8">
      <a routerLink="/dashboard" class="font-serif text-2xl text-text-primary">I</a>
    </div>
    
    <div class="flex-1 flex flex-col items-center space-y-2">
      <a routerLink="/dashboard" class="nav-rail-item" title="Dashboard">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="flex-1 ml-rail">
    @if (isLoading()) {
      <div class="flex items-center justify-center h-screen">
        <div class="text-text-muted">Loading project...</div>
      </div>
    } @else if (project()) {
      <!-- Header -->
      <header class="border-b border-brand-border bg-brand-white px-8 py-6">
        <div class="flex justify-between items-center">
          <div>
            <a routerLink="/dashboard" class="text-text-muted text-sm hover:text-text-primary">← Back to Dashboard</a>
            <h1 class="font-serif text-3xl mt-2 text-text-primary">{{ project()?.title }}</h1>
            @if (project()?.description) {
              <p class="text-text-muted mt-1">{{ project()?.description }}</p>
            }
          </div>
          <div class="flex items-center space-x-4">
            <button (click)="openTeamModal()" class="btn btn-secondary">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              Team
            </button>
            <button (click)="openCreateDocModal()" class="btn btn-primary">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
              </svg>
              New Document
            </button>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <div class="p-8">
        @if (documents().length === 0) {
          <!-- Empty State -->
          <div class="text-center py-16 border border-dashed border-brand-border">
            <svg class="w-16 h-16 mx-auto text-text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <h3 class="font-serif text-xl text-text-primary mb-2">No documents yet</h3>
            <p class="text-text-muted mb-6">Create your first document to start writing.</p>
            <button (click)="openCreateDocModal()" class="btn btn-primary">Create First Document</button>
          </div>
        } @else {
          <!-- Documents List -->
          <div class="mb-6">
            <h2 class="subheading mb-4">Documents</h2>
          </div>

          <div class="space-y-3">
            @for (doc of documents(); track doc.id) {
              <a [routerLink]="['/editor', doc.id]" class="card flex items-center justify-between group cursor-pointer hover:border-text-primary transition-colors">
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-brand-panel flex items-center justify-center mr-4">
                    <svg class="w-5 h-5 text-text-inverse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                  </div>
                  <div>
                    <h3 class="font-medium text-text-primary group-hover:underline">{{ doc.title }}</h3>
                    <p class="text-xs text-text-muted">v{{ doc.version }} · {{ formatWordCount(doc.wordCount) }} words</p>
                  </div>
                </div>
                <div class="text-text-muted">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"></path>
                  </svg>
                </div>
              </a>
            }
          </div>
        }
      </div>
    } @else {
      <div class="flex items-center justify-center h-screen">
        <div class="text-center">
          <h2 class="font-serif text-xl text-text-primary mb-2">Project not found</h2>
          <a routerLink="/dashboard" class="text-text-muted hover:text-text-primary underline">Return to dashboard</a>
        </div>
      </div>
    }
  </main>
</div>

<!-- Create Document Modal -->
@if (showCreateDocModal()) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeCreateDocModal()">
    <div class="bg-brand-white border border-brand-border w-full max-w-md mx-4 shadow-lg" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between px-6 py-5 border-b border-brand-border">
        <h2 class="font-serif text-xl text-text-primary">New Document</h2>
        <button (click)="closeCreateDocModal()" class="text-text-muted hover:text-text-primary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="p-6">
        <div class="space-y-2">
          <label for="docTitle" class="block text-sm font-medium text-text-primary">Document Title</label>
          <input 
            type="text" 
            id="docTitle"
            [(ngModel)]="newDocTitle"
            class="form-input w-full"
            placeholder="e.g., Chapter 1: The Beginning"
            (keyup.enter)="createDocument()"
          />
        </div>
      </div>
      
      <div class="flex justify-end gap-3 px-6 py-4 border-t border-brand-border bg-brand-canvas">
        <button (click)="closeCreateDocModal()" class="btn btn-secondary">Cancel</button>
        <button 
          (click)="createDocument()" 
          [disabled]="!newDocTitle.trim() || isCreatingDoc()"
          class="btn btn-primary"
        >
          {{ isCreatingDoc() ? 'Creating...' : 'Create Document' }}
        </button>
      </div>
    </div>
  </div>
}

<!-- Team Modal -->
@if (showTeamModal()) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" (click)="closeTeamModal()">
    <div class="bg-brand-white border border-brand-border w-full max-w-lg mx-4 shadow-lg" (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between px-6 py-5 border-b border-brand-border">
        <h2 class="font-serif text-xl text-text-primary">Team Members</h2>
        <button (click)="closeTeamModal()" class="text-text-muted hover:text-text-primary">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="p-6">
        <!-- Invite Form -->
        <div class="flex gap-3 mb-6">
          <input 
            type="email" 
            [(ngModel)]="inviteEmail"
            class="form-input flex-1"
            placeholder="Enter email to invite"
            (keyup.enter)="inviteMember()"
          />
          <button 
            (click)="inviteMember()" 
            [disabled]="!inviteEmail.trim() || isInviting()"
            class="btn btn-primary"
          >
            {{ isInviting() ? 'Inviting...' : 'Invite' }}
          </button>
        </div>
        
        <!-- Members List -->
        <div class="space-y-3">
          @for (member of members(); track member.userId) {
            <div class="flex items-center justify-between py-3 border-b border-brand-border last:border-b-0">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand-panel flex items-center justify-center">
                  <span class="text-text-inverse font-medium">{{ member.user?.displayName?.charAt(0) || '?' }}</span>
                </div>
                <div>
                  <p class="font-medium text-text-primary">{{ member.user?.displayName || 'Unknown' }}</p>
                  <p class="text-xs text-text-muted">{{ member.role }}</p>
                </div>
              </div>
              @if (member.role !== 'Owner') {
                <button (click)="removeMember(member.userId)" class="text-text-muted hover:text-red-600 text-sm">
                  Remove
                </button>
              }
            </div>
          } @empty {
            <p class="text-text-muted text-center py-4">No team members yet</p>
          }
        </div>
      </div>
      
      <div class="flex justify-end px-6 py-4 border-t border-brand-border bg-brand-canvas">
        <button (click)="closeTeamModal()" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>
}
